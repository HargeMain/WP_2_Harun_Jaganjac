<div class="meal-tracker-container" [style.background-color]="primaryColor" [style.color]="secondaryColor">
    <div class="header-section">
        <span class="material-icons tracker-icon" [style.color]="secondaryColor">restaurant</span>
        <h2 class="title">Meal Tracker</h2>
    </div>

    <div class="meal-main-layout">
        <div class="left-column">
            <form [formGroup]="mealForm" (ngSubmit)="onSubmit()" class="meal-form">
                <div class="input-group">
                    <label>Date</label>
                    <input type="date" formControlName="date" [style.color]="secondaryColor">
                </div>

                <div class="meals-array" formArrayName="meals">
                    <h3>Meals</h3>
                    
                    <div *ngFor="let meal of meals.controls; let i = index" class="meal-item" [formGroupName]="i">
                        <input formControlName="name" placeholder="Meal name" [style.color]="secondaryColor">
                        <input type="number" formControlName="calories" placeholder="Calories" [style.color]="secondaryColor" min="0">
                        <button type="button" (click)="removeMeal(i)" class="remove-btn" [style.color]="secondaryColor">
                            <span class="material-icons">delete_forever</span>
                        </button>
                    </div>

                    <button type="button" (click)="addMeal()" class="add-btn" [style.background-color]="secondaryColor" [style.color]="primaryColor">
                        <span class="material-icons">add_circle</span> Add Meal
                    </button>
                </div>

                <button type="submit" class="update-btn" [disabled]="isLoading || mealForm.invalid" [style.background-color]="secondaryColor" [style.color]="primaryColor">
                    <span *ngIf="isLoading" class="spinner"></span>
                    {{ isLoading ? 'Saving...' : 'Save Today' }}
                </button>
            </form>

            <div class="stats-container">
                <div class="insights-section" *ngIf="aiInsights.length">
                    <h3>AI Insights</h3>
                    <div *ngFor="let insight of aiInsights" class="insight-card" [class]="insight.type">
                        <span class="material-icons insight-icon">auto_awesome</span>
                        <p>{{ insight.message }}</p>
                    </div>
                </div>

                <div class="progress-section" *ngIf="mealEntries.length">
                    <h3>Today's Nutrition Progress</h3>
                    <div class="progress-info">
                        <span class="calorie-count">{{ todayCalories }} / {{ dailyCalorieGoal }} kcal</span>
                        <span class="calorie-percentage">{{ calorieProgress | number:'1.0-0' }}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width]="calorieProgress + '%'" [style.background-color]="secondaryColor"></div>
                    </div>
                    <p class="calorie-goal">Daily goal: {{ dailyCalorieGoal }} kcal</p>
                </div>
            </div>

            <button (click)="resetMeals()" class="reset-btn" [style.background-color]="secondaryColor" [style.color]="primaryColor">
                Reset All Meals
            </button>
        </div>

        <div class="right-column">
            <div class="entries-header">
                <h3>Meal History</h3>
                <span class="entries-count" *ngIf="mealEntries.length">{{ mealEntries.length }} entries</span>
            </div>
            
            <div class="entries-container" *ngIf="mealEntries.length">
                <div class="entries-list">
                    <div *ngIf="isLoading" class="loading">Loading...</div>
                    <div *ngFor="let entry of mealEntries; let entryIdx = index" class="entry-card">
                        <div class="entry-header">
                            <h4>{{ entry.date }}</h4>
                            <span class="total-calories">Total: {{ getTotalCalories(entry.meals) }} kcal</span>
                        </div>
                        <ul>
                            <li *ngFor="let meal of entry.meals; let mealIdx = index" class="meal-check">
                                <input type="checkbox" [checked]="meal.completed" (change)="toggleCompleted(entryIdx, mealIdx)">
                                <span [class.completed]="meal.completed">{{ meal.name }}</span>
                                <span class="meal-calories">{{ meal.calories }} kcal</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div *ngIf="!mealEntries.length && !isLoading" class="empty-state">
                <p>No meals tracked yet. Start by adding some meals above!</p>
            </div>
        </div>
    </div>

    <div class="save-notification" *ngIf="showSaveNotification">
        <span class="material-icons">check_circle</span>
        Meals saved successfully!
    </div>
</div>
